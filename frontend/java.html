<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Java Full Stack Developer Course</title>

  <link rel="icon" href="./logo.png" type="image/png">
  <link rel="stylesheet" href="./java.css">
</head>
<body>

<section class="hero">
  <div class="overlay">
    <h1>Java Full Stack Developer Course</h1>
    <p class="meta">Duration: 6 Months | Price: ₹45,000</p>
    <button onclick="openForm()">Enroll Now</button>
  </div>
</section>

<section class="section">
  <h2>Course Overview</h2>
  <p>
    This Java Full Stack Developer course provides comprehensive training in both
    frontend and backend application development using industry-relevant technologies.
    Learners gain strong fundamentals in Core Java, Advanced Java and real-time
    project exposure to become job-ready developers.
  </p>
</section>

<section class="section dark">
  <h2>Course Syllabus</h2>

  <div class="module">
    <h3>Module 1: Core Java</h3>
    <p>OOP concepts, collections, multithreading, exception handling</p>
  </div>

  <div class="module">
    <h3>Module 2: Advanced Java</h3>
    <p>JDBC, Servlets, JSP, MVC architecture</p>
  </div>

  <div class="module">
    <h3>Module 3: Frontend</h3>
    <p>HTML5, CSS3, JavaScript</p>
  </div>

  <div class="module">
    <h3>Module 4: Spring Boot</h3>
    <p>REST APIs, dependency injection</p>
  </div>

  <div class="module">
    <h3>Module 5: Database</h3>
    <p>SQL, CRUD operations, integration</p>
  </div>
</section>

<section class="section">
  <h2>Course Highlights</h2>
  <div class="syllabus-item">Industry-oriented curriculum</div>
  <div class="syllabus-item">Hands-on real-time projects</div>
  <div class="syllabus-item">Interview & placement support</div>
</section>

<section class="section dark">
  <h2>Who Can Enroll</h2>
  <p>
    Fresh graduates, final-year students, career switchers,
    and working professionals.
  </p>
</section>

<!-- ================= POPUP FORM ================= -->
<div class="popup" id="formPopup">
  <div class="form-box">
    <span class="close" onclick="closeForm()">×</span>
    <h2>Course Enrollment Form</h2>

    <form onsubmit="redirectPage(event)">
      
      <input 
        type="text" 
        id="fullName" 
        placeholder="Full Name" 
        required 
        onfocus="autoFillName()"
      >

      <input 
        type="email" 
        id="email" 
        placeholder="Email" 
        required
        onfocus="autoFillEmail()"
      >

      <input 
        type="tel" 
        id="phone" 
        placeholder="Phone Number" 
        required
        onfocus="autoFillPhone()"
      >

      <select id="gender" required>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>

      <input type="text" id="qualification" placeholder="Qualification" required>
      <input type="text" id="address" placeholder="Address" required>

      <button type="submit">Submit</button>
    </form>

  </div>
</div>

<!-- ================= JS ================= -->
<script>
/* =========================
   COURSE ID + POPUP
========================= */
function openForm() {
  localStorage.setItem("courseId", "6989bdd57bc96536198a39b3");
  document.getElementById("formPopup").style.display = "flex";
}

function closeForm() {
  document.getElementById("formPopup").style.display = "none";
}

window.onclick = function (event) {
  const popup = document.getElementById("formPopup");
  if (event.target === popup) closeForm();
};

/* =========================
   STORAGE HELPERS
========================= */
function getToken() {
  return localStorage.getItem("token"); // JWT string
}

function getUser() {
  const userStr = localStorage.getItem("user"); // user object
  if (!userStr) return null;
  return JSON.parse(userStr);
}

/* =========================
   AUTO FILL (ON FOCUS)
========================= */
function autoFillName() {
  const user = getUser();
  if (!user) return;
  document.getElementById("fullName").value = user.name || user.userName || "";
}

function autoFillEmail() {
  const user = getUser();
  if (!user) return;
  document.getElementById("email").value = user.email || "";
}

function autoFillPhone() {
  const user = getUser();
  if (!user) return;
  document.getElementById("phone").value = user.phoneNumber || user.phone || "";
}

/* =========================
   FORM SUBMIT
========================= */
async function redirectPage(event) {
  event.preventDefault();

  const user = getUser();       
  const token = getToken();     
  const courseId = localStorage.getItem("courseId");

  if (!user || !token) {
    alert("Login required");
    return;
  }

  const gender = document.getElementById("gender").value;
  const qualification = document.getElementById("qualification").value;
  const address = document.getElementById("address").value;

  const payload = {
    trainee_id: user.id,   // ✅ userId
    qualification,
    gender,
    address,
    courseId
  };

  console.log("Sending payload:", payload);

  try {
    const res = await fetch("http://localhost:5000/api/trainee/applycourse/createTrainee", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`   // ✅ JWT auth
      },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (!res.ok) {
      console.error("Backend error:", data);
      alert(data.message || "Failed");
      return;
    }

    alert("✅ Course applied successfully");
    closeForm();
    console.log("SUCCESS:", data);

  } catch (err) {
    console.error("Fetch error:", err);
    alert("Server error");
  }
}
</script>

</body>
</html>
