<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Python Full Stack Developer Course</title>

  <link rel="icon" href="./logo.png" type="image/png">
  <link rel="stylesheet" href="python.css">
</head>
<body>

<section class="hero">
  <div class="overlay">
    <h1>Python Full Stack Developer Course</h1>
    <p class="meta">Duration: 6 Months | Price: ₹50,000</p>
    <button onclick="openForm()">Enroll Now</button>
  </div>
</section>

<section class="section">
  <h2>Course Overview</h2>
  <p>
    This Python Full Stack Developer course equips learners with complete knowledge of 
    frontend and backend development using Python-based frameworks and technologies. 
    The course covers Python fundamentals, object-oriented programming, Django, Flask, 
    and web development practices. Students gain hands-on experience through real-time 
    projects, preparing them for professional roles in software development.
  </p>
</section>

<section class="section dark">
  <h2>Course Syllabus</h2>

  <div class="module">
    <h3>Module 1: Python Fundamentals</h3>
    <p>Python basics, data types, loops, functions, OOP concepts, exception handling.</p>
  </div>

  <div class="module">
    <h3>Module 2: Advanced Python</h3>
    <p>File handling, modules, decorators, generators, multithreading, Python libraries.</p>
  </div>

  <div class="module">
    <h3>Module 3: Frontend Development</h3>
    <p>HTML5, CSS3, JavaScript, responsive design, client-side validation.</p>
  </div>

  <div class="module">
    <h3>Module 4: Django & Flask</h3>
    <p>Django core concepts, Flask microframework, REST APIs, MVC pattern, web apps.</p>
  </div>

  <div class="module">
    <h3>Module 5: Database & Backend Integration</h3>
    <p>SQL, ORM, database design, CRUD operations, backend integration with Python.</p>
  </div>
</section>

<section class="section">
  <h2>Course Highlights</h2>
  <div class="syllabus-item">Industry-focused Python Full Stack curriculum</div>
  <div class="syllabus-item">Hands-on real-time projects</div>
  <div class="syllabus-item">Mock interviews & placement support</div>
</section>

<section class="section dark">
  <h2>Who Can Enroll</h2>
  <p>
    Fresh graduates, final-year students, career switchers, and working professionals.
  </p>
</section>

<!-- ================= POPUP FORM ================= -->
<div class="popup" id="formPopup">
  <div class="form-box">
    <span class="close" onclick="closeForm()">×</span>
    <h2>Course Enrollment Form</h2>

    <form onsubmit="redirectPage(event)">
      
      <input 
        type="text" 
        id="fullName" 
        placeholder="Full Name" 
        required 
        onfocus="autoFillName()"
      >

      <input 
        type="email" 
        id="email" 
        placeholder="Email" 
        required
        onfocus="autoFillEmail()"
      >

      <input 
        type="tel" 
        id="phone" 
        placeholder="Phone Number" 
        required
        onfocus="autoFillPhone()"
      >

      <select id="gender" required>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>

      <input type="text" id="qualification" placeholder="Qualification" required>
      <input type="text" id="address" placeholder="Address" required>

      <button type="submit">Submit</button>
    </form>

  </div>
</div>

<!-- ================= JS ================= -->
<script>
/* =========================
   COURSE ID + POPUP
========================= */
function openForm() {
  // ✅ store python courseId
  localStorage.setItem("courseId", "698b22fb9e01bf6880d88f6f");
  document.getElementById("formPopup").style.display = "flex";
}

function closeForm() {
  document.getElementById("formPopup").style.display = "none";
}

window.onclick = function (event) {
  const popup = document.getElementById("formPopup");
  if (event.target === popup) closeForm();
};

/* =========================
   STORAGE HELPERS
========================= */
function getToken() {
  return localStorage.getItem("token"); // JWT string
}

function getUser() {
  const userStr = localStorage.getItem("user"); // user object
  if (!userStr) return null;
  return JSON.parse(userStr);
}

/* =========================
   AUTO FILL
========================= */
function autoFillName() {
  const user = getUser();
  if (!user) return;
  document.getElementById("fullName").value = user.userName || user.name || "";
}

function autoFillEmail() {
  const user = getUser();
  if (!user) return;
  document.getElementById("email").value = user.email || "";
}

function autoFillPhone() {
  const user = getUser();
  if (!user) return;
  document.getElementById("phone").value = user.phoneNumber || user.phone || "";
}

/* =========================
   FORM SUBMIT
========================= */
async function redirectPage(event) {
  event.preventDefault();

  const user = getUser();       
  const token = getToken();     
  const courseId = localStorage.getItem("courseId");  // ✅ from storage

  if (!user || !token) {
    alert("Login required");
    return;
  }

  const gender = document.getElementById("gender").value;
  const qualification = document.getElementById("qualification").value;
  const address = document.getElementById("address").value;

  const payload = {
    trainee_id: user.id,   // ✅ correct id
    qualification,
    gender,
    address,
    courseId
  };

  console.log("Sending payload:", payload);

  try {
    const res = await fetch("http://localhost:5000/api/trainee/applycourse/createTrainee", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (!res.ok) {
      console.error("Backend error:", data);
      alert(data.message || "Failed");
      return;
    }

    alert("✅ Python course applied successfully");
    closeForm();
    console.log("SUCCESS:", data);

  } catch (err) {
    console.error("Fetch error:", err);
    alert("Server error");
  }
}
</script>

</body>
</html>
